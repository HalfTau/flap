pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--game stuff
function _init()
	chars = {"a","b","c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "x", "y", "z"}
	cartdata("flappy_sp")
	scores = dget(0)
	--music(0)
	vals()
end

function vals()
	tick = 0
	game_over=false
	make_menu()
	make_score()
	make_cave()
	make_player()
end

function _update()
	if (menu) then
		update_menu()
	elseif (not game_over) then
  	update_score()
   update_cave()
 	 move_player()
 	 check_hit()	
 	else
 		if(btn(4)) then
 			save_score()
  		for inc=1,100 do
					print("what")
  		end
 			vals()
 		end
	end
end

function _draw()
	cls()
	if(menu) then
		draw_menu()
	else
 	draw_cave()
 	draw_player()
 	draw_score()
 	if(game_over) then
 		game_over_message()
 	end
 end
end

function game_over_message()
	tick+=1
	tmp = flr(tick/30)
	if(tmp%2==0) then
 	print("game over",46,40,10)
 	print("score: " .. flr(score.val), 45, 50, 10)
 	print("🅾️return to menu",32,60,10)
 end
end
-->8
--player stuff
function make_player()
	player={}
	player.x=24
	player.y=60
	player.dy=0
	player.rise=1
	player.fall=2
	player.dead=3
	player.steady=7
	player.speed=3
	player.score=0
end

function draw_player()
	if (game_over) then
		spr(player.dead,player.x,player.y)
	elseif (player.dy<0) then
		spr(player.rise,player.x,player.y)
	elseif(player.dy>0) then
		spr(player.fall,player.x,player.y)
 elseif(player.dy==0) then
  spr(player.steady,player.x,player.y)
	end
end

function move_player()
	gravity = 0.2
	player.dy+=gravity
	
	--jump
	if (btnp(2) and player.dy > -6) then
		sfx(0)
		player.dy-=2
	end
	
	--move to new location
 player.y+=player.dy
end

function check_hit()
	for i=player.x,player.x+7 do
		if(cave[i+1].top>player.y+2
			or cave[i+1].btm<player.y+5) then
			game_over=true
			sfx(1)
		end
	end
end





-->8
-- cave stuff
function make_cave()
	cave={{["top"]=5,["btm"]=119}}
	top=58
	btm=72
end

function update_cave()
	--remove back of cave
	if (#cave>player.speed) then
		for i=1,player.speed do
			del(cave,cave[1])
		end
	end
	
	--add more cave
	while(#cave<128) do
		local col={}
		local up=flr(rnd(7)-3)
		local dwn=flr(rnd(7)-3)
		local upns=flr(rnd(10))
		local dwnns=flr(rnd(10))
		col.top=mid(3,cave[#cave].top+up,top)
		col.btm=mid(btm,cave[#cave].btm+dwn,124)
		add(cave,col)
	end
end

function draw_cave()
--	rectfill(0,0,128,0) -- background
	top_color=14
	btm_color=8
	for i=1, #cave do
		line(i-1,0,i-1,cave[i].top,top_color)
		line(i-1,127,i-1,cave[i].btm,btm_color)
	end
end 
-->8
--score stuff

function make_score()
	score = {}
	score.name = "test"
	score.val = 0
end

function update_score()
	score.val+=0.05
end

function draw_score()
	print(flr(score.val),0,0,10)
end

function save_score()
	dset(0, flr(score.val))
	dset(1, 2)
	dset(2, 1)
	dset(3, 19)
end
-->8
--menu stuff
function make_menu()
 menu=true
 options={"start game", "high scores"}
 mind = 1 --menu pos 
end

function update_menu()
	if(btn(3) and mind < #options) then
		mind+=1
	elseif(btn(2) and mind>1) then
		mind-=1
	elseif(btn(4)) then
		if(mind==1)then 
			menu=false
		elseif(mind==2) then
		end
	end
end

function draw_menu()
 for i=1,#options do
 	pos = i*6
 	if(i==mind) then
 		print(options[i].." ∧", 0, pos, 7)
 	else
 		print(options[i], 0, pos, 6)
 	end
 end
 print(dget(0).. " " .. chars[dget(1)]..chars[dget(2)]..chars[dget(3)], 0, 20, 6)
end
__gfx__
000000000000000000000000800000086000000600000000600000060000077777000000ffffffff000000000000000000000000000000000000000000000000
000000000000000000000000080000806600006600000000060000600000077770700000ffffffff000000000000000000000000000000000000000000000000
007007000000077700000777008008776066660600000000006006000000707707070000ffffffff000000000000000000000000000000000000000000000000
000770007070777707070777070887770606606000666600006666000007070000707000ffffffff000000000000000000000000000000000000000000000000
000770000707077770707777707887770066660000666600006666000070700000070700ffffffff000000000000000000000000000000000000000000000000
007007000000000000000000008008000066660000600600000000000707000000007077ffffffff000000000000000000000000000000000000000000000000
000000000000000000000000080000800000000006000060000000007070000000000777ffffffff000000000000000000000000000000000000000000000000
000000000000000000000000800000080000000060000006000000000700000000000777ffffffff000000000000000000000000000000000000000000000000
000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b00b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010107070000008050000000000015050000000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000024050240500f3500a05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0108070a0d0500f050120500d05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 00024344

