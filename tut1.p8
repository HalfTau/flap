pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--game stuff
function _init()
	tick = 0
	game_over=false
	menu=true
	make_score()
	make_cave()
	make_player()
end

function _update()
 if (not game_over) then
 	update_score()
  update_cave()
	 move_player()
	 check_hit()	
	else
		if(btn(4)) then
			_init()
		end
	end
end

function _draw()
	cls()
	draw_cave()
	draw_player()
	draw_score()
	if(game_over) then
		game_over_message()
	end
end

function game_over_message()
	tick+=1
	tmp = flr(tick/30)
	if(tmp%2==0) then
 	print("game over",46,40,10)
 	print("continue?",46,55,10)
 	print("press 🅾️",48,62,10)
 end
end
-->8
--player stuff
function make_player()
	player={}
	player.x=24
	player.y=60
	player.dy=0
	player.rise=7
	player.fall=8
	player.dead=3
	player.speed=3
	player.score=0
end

function draw_player()
	if (game_over) then
		spr(player.dead,player.x,player.y)
	elseif (player.dy<0) then
		spr(player.rise,player.x,player.y)
	else
		spr(player.fall,player.x,player.y)
	end
end

function move_player()
	gravity = 0.2
	player.dy+=gravity
	
	--jump
	if (btnp(2) and player.dy > -6) then
		sfx(0)
		player.dy-=2
	end
	
	--move to new location
 player.y+=player.dy
end

function check_hit()
	for i=player.x,player.x+7 do
		if(cave[i+1].top>player.y+2
			or cave[i+1].btm<player.y+5) then
			game_over=true
			sfx(1)
		end
	end
end





-->8
-- cave stuff
function make_cave()
	cave={{["top"]=5,["btm"]=119}}
	top=60
	btm=70
end

function update_cave()
	--remove back of cave
	if (#cave>player.speed) then
		for i=1,player.speed do
			del(cave,cave[1])
		end
	end
	
	--add more cave
	while(#cave<128) do
		local col={}
		local up=flr(rnd(7)-3)
		local dwn=flr(rnd(7)-3)
		local upns=flr(rnd(10))
		local dwnns=flr(rnd(10))
		col.top=mid(3,cave[#cave].top+up,top)
		col.btm=mid(btm,cave[#cave].btm+dwn,124)
		add(cave,col)
	end
end

function draw_cave()
	top_color=14
	btm_color=8
	for i=1, #cave do
		line(i-1,0,i-1,cave[i].top,top_color)
		line(i-1,127,i-1,cave[i].btm,btm_color)
	end
end 
-->8
--score stuff

function make_score()
	score = {}
	score.val = 0
end

function update_score()
	score.val+=0.05
end

function draw_score()
	print(flr(score.val),0,0,10)
end
__gfx__
00000000000000000000000080000008600000060000000060000006000007777700000000000000000000000000000000000000000000000000000000000000
00000000000000000000000008000080660000660000000006000060000007777070000000000000000000000000000000000000000000000000000000000000
00700700000007770000077700800877606666060000000000600600000077770707000000000000000000000000000000000000000000000000000000000000
00077000707077770707077707088777060660600066660000666600000707000070700000000000000000000000000000000000000000000000000000000000
00077000070707777070777770788777006666000066660000666600007070000007070000000000000000000000000000000000000000000000000000000000
00700700000000000000000000800800006666000060060000000000070700000000707700000000000000000000000000000000000000000000000000000000
00000000000000000000000008000080000000000600006000000000707000000000077700000000000000000000000000000000000000000000000000000000
00000000000000000000000080000008000000006000000600000000070000000000077700000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b00b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b00b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f003f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f003f003f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f003f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000008050000000000015050000000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000024050240500f3500a05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01424344

