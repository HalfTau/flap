pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--game stuff
function _init()
	chars = {"a","b","c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "x", "y", "z"}
	cartdata("flappy_sp")
	--music(0)
	vals()
end

function vals()
	tick = 0
	game_over=false
	make_menu()
	make_score()
	make_cave()
	make_player()
end

function _update()
	if (menu) then
		update_menu()
	elseif (not game_over) then
	 game()
 else
	 highscore()
 end
end

function _draw()
	cls()
	if(menu) then
		draw_menu()
	else
		map(0,0,0,0,127,250)
 	draw_cave()
 	draw_player()
 	draw_score()
 	if(game_over) then
 		game_over_message()
 	end
 end
end

function game_over_message()
	tick+=1
	tmp = flr(tick/30)
	local clr = 0
	if(tmp%2==0) then
		clr=10
 else
 	clr=8
 end
 print("game over",46,40,clr)
	print("score: " .. flr(score.val), 45, 50, clr)
	print("🅾️return to menu",32,60,clr)
end

function zero_scores()
	for i=0,64 do
		dset(i,0)
	end
end

function get_scores()
	if(dget(0)!=0) then
		scores = dget(0)
		return true
	else
		return false
	end
end

function game()
	update_score()
 update_cave()
 move_player()
 check_hit()	
end

function highscore()
	if(btn(4)) then
		save_score()
		for inc=1,100 do
			print("what")
		end
		vals()
	end
end
-->8
--player stuff
function make_player()
	player={}
	player.x=24
	player.y=60
	player.dy=0
	player.rise=1
	player.fall=2
	player.dead=3
	player.steady=7
	player.speed=3
	player.score=0
end

function draw_player()
	if (game_over) then
		spr(player.dead,player.x,player.y)
	elseif (player.dy<0) then
		spr(player.rise,player.x,player.y)
	elseif(player.dy>0) then
		spr(player.fall,player.x,player.y)
 elseif(player.dy==0) then
  spr(player.steady,player.x,player.y)
	end
end

function move_player()
	gravity = 0.2
	player.dy+=gravity
	
	--jump
	if (btnp(2) and player.dy > -6) then
		sfx(0)
		player.dy-=2
	end
	
	--move to new location
 player.y+=player.dy
end

function check_hit()
	for i=player.x,player.x+7 do
		if(cave[i+1].top>player.y+2
			or cave[i+1].btm<player.y+5) then
			game_over=true
			sfx(1)
		end
	end
end





-->8
-- cave stuff
function make_cave()
	cave={{["top"]=5,["btm"]=119}}
	top=58
	btm=72
end

function update_cave()
	--remove back of cave
	if (#cave>player.speed) then
		for i=1,player.speed do
			del(cave,cave[1])
		end
	end
	
	--add more cave
	while(#cave<128) do
		local col={}
		local up=flr(rnd(7)-3)
		local dwn=flr(rnd(7)-3)
		local upns=flr(rnd(10))
		local dwnns=flr(rnd(10))
		col.top=mid(3,cave[#cave].top+up,top)
		col.btm=mid(btm,cave[#cave].btm+dwn,124)
		add(cave,col)
	end
end

function draw_cave()
--	rectfill(0,0,128,0) -- background
	top_color=14
	btm_color=8
	for i=1, #cave do
		line(i-1,0,i-1,cave[i].top,top_color)
		line(i-1,127,i-1,cave[i].btm,btm_color)
	end
end 
-->8
--score stuff

function make_score()
	has_scores = get_scores()
	score = {}
	score.name = "test"
	score.val = 0
end

function update_score()
	score.val+=0.05
end

function draw_score()
--	rectfill(100,0,127,8,7)
	print("score: " .. flr(score.val),92,0,7)
end

function save_score()
	dset(0, flr(score.val))
	dset(1, 2)
	dset(2, 1)
	dset(3, 19)
end
-->8
--menu stuff
function make_menu()
 menu=true
 options={"start game", "high scores"}
 mind = 1 --menu pos 
end

function update_menu()
	if(btn(3) and mind < #options) then
		mind+=1
	elseif(btn(2) and mind>1) then
		mind-=1
	elseif(btn(4)) then
		if(mind==1)then 
			menu=false
		elseif(mind==2) then
		end
	end
end

function draw_menu()
 for i=1,#options do
 	pos = i*6
 	if(i==mind) then
 		print(options[i].." ∧", 0, pos, 7)
 	else
 		print(options[i], 0, pos, 6)
 	end
 end
	if(has_scores) then
	 print(dget(0).. " " .. chars[dget(1)]..chars[dget(2)]..chars[dget(3)], 0, 20, 6)
	end
end
__gfx__
00000000000000000000000080000008600000060000000060000006000007777700000022222222000000000000000000000000000000000000000000000000
00000000000000000000000008000080660000660000000006000060000007777070000022222222000000000000000000000000000000000000000000000000
00700700000007770000077700800877606666060000000000600600000070770707000022222222000000000000000000000000000000000000000000000000
00077000707077770707077707088777060660600066660000666600000707000070700022222222000000000000000000000000000000000000000000000000
00077000070707777070777770788777006666000066660000666600007070000007070022222222000000000000000000000000000000000000000000000000
00700700000000000000000000800800006666000060060000000000070700000000707722222222000000000000000000000000000000000000000000000000
00000000000000000000000008000080000000000600006000000000707000000000077722222222000000000000000000000000000000000000000000000000
00000000000000000000000080000008000000006000000600000000070000000000077722222222000000000000000000000000000000000000000000000000
000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b00b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010107070000008050000000000015050000000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000024050240500f3500a05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0108070a0d0500f050120500d05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 00024344

